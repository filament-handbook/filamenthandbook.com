var _=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],k=_.join(","),K="u"<typeof Element,N=K?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,B=!K&&Element.prototype.getRootNode?function(e){return e.getRootNode()}:function(e){return e.ownerDocument},V=function(e,t,n){var o=Array.prototype.slice.apply(e.querySelectorAll(k));return t&&N.call(e,k)&&o.unshift(e),o=o.filter(n)},$=function e(t,n,o){for(var r=[],a=Array.from(t);a.length;){var i,u,c=a.shift();"SLOT"===c.tagName?(i=e((i=c.assignedElements()).length?i:c.children,!0,o),o.flatten?r.push.apply(r,i):r.push({scope:c,candidates:i})):(N.call(c,k)&&o.filter(c)&&(n||!t.includes(c))&&r.push(c),i=c.shadowRoot||"function"==typeof o.getShadowRoot&&o.getShadowRoot(c),u=!o.shadowRootFilter||o.shadowRootFilter(c),i&&u?(u=e((!0===i?c:i).children,!0,o),o.flatten?r.push.apply(r,u):r.push({scope:c,candidates:u})):a.unshift.apply(a,c.children))}return r},Y=function(e,t){return e.tabIndex<0&&(t||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},se=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},Z=function(e){return"INPUT"===e.tagName},ce=function(e){return Z(e)&&"hidden"===e.type},le=function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some(function(e){return"SUMMARY"===e.tagName})},fe=function(e,t){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===t)return e[n]},de=function(e){if(!e.name)return!0;function t(e){return n.querySelectorAll('input[type="radio"][name="'+e+'"]')}var n=e.form||B(e);if(typeof window<"u"&&typeof window.CSS<"u"&&"function"==typeof window.CSS.escape)o=t(window.CSS.escape(e.name));else try{o=t(e.name)}catch(e){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",e.message),!1}var o=fe(o,e.form);return!o||o===e},be=function(e){return Z(e)&&"radio"===e.type},ve=function(e){return be(e)&&!de(e)},W=function(e){e=e.getBoundingClientRect();return 0===e.width&&0===e.height},he=function(e,t){var n=t.displayCheck,o=t.getShadowRoot;if("hidden"===getComputedStyle(e).visibility)return!0;t=N.call(e,"details>summary:first-of-type")?e.parentElement:e;if(N.call(t,"details:not([open]) *"))return!0;t=B(e).host,t=t?.ownerDocument.contains(t)||e.ownerDocument.contains(e);if(n&&"full"!==n){if("non-zero-area"===n)return W(e)}else{if("function"==typeof o){for(n=e;e;){var r=e.parentElement,a=B(e);if(r&&!r.shadowRoot&&!0===o(r))return W(e);e=e.assignedSlot||(r||a===e.ownerDocument?r:a.host)}e=n}if(t)return!e.getClientRects().length}return!1},pe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if("FIELDSET"===t.tagName&&t.disabled){for(var n=0;n<t.children.length;n++){var o=t.children.item(n);if("LEGEND"===o.tagName)return!!N.call(t,"fieldset[disabled] *")||!o.contains(e)}return!0}t=t.parentElement}return!1},I=function(e,t){return!(t.disabled||ce(t)||he(t,e)||le(t)||pe(t))},G=function(e,t){return!(ve(t)||Y(t)<0||!I(e,t))},ge=function(e){e=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(e)||0<=e)},me=function i(e){var u=[],c=[];return e.forEach(function(e,t){var n=!!e.scope,o=n?e.scope:e,r=Y(o,n),a=n?i(e.candidates):o;0===r?n?u.push.apply(u,a):u.push(o):c.push({documentOrder:t,tabIndex:r,item:e,isScope:n,content:a})}),c.sort(se).reduce(function(e,t){return t.isScope?e.push.apply(e,t.content):e.push(t.content),e},[]).concat(u)},z=function(e,t){e=(t=t||{}).getShadowRoot?$([e],t.includeContainer,{filter:G.bind(null,t),flatten:!1,getShadowRoot:t.getShadowRoot,shadowRootFilter:ge}):V(e,t.includeContainer,G.bind(null,t));return me(e)},x=function(e,t){return(t=t||{}).getShadowRoot?$([e],t.includeContainer,{filter:I.bind(null,t),flatten:!0,getShadowRoot:t.getShadowRoot}):V(e,t.includeContainer,I.bind(null,t))},A=function(e,t){if(t=t||{},e)return!1!==N.call(e,k)&&G(t,e);throw new Error("No node provided")},ye=_.concat("iframe").join(","),R=function(e,t){if(t=t||{},e)return!1!==N.call(e,ye)&&I(t,e);throw new Error("No node provided")};function Q(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function X(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(n),!0).forEach(function(e){we(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J=(()=>{var n=[];return{activateTrap:function(e){0<n.length&&(t=n[n.length-1])!==e&&t.pause();var t=n.indexOf(e);-1!==t&&n.splice(t,1),n.push(e)},deactivateTrap:function(e){e=n.indexOf(e);-1!==e&&n.splice(e,1),0<n.length&&n[n.length-1].unpause()}}})(),Te=function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select},Fe=function(e){return"Escape"===e.key||"Esc"===e.key||27===e.keyCode},Se=function(e){return"Tab"===e.key||9===e.keyCode},ee=function(e){return setTimeout(e,0)},te=function(e,n){var o=-1;return e.every(function(e,t){return!n(e)||(o=t,!1)}),o},O=function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return"function"==typeof e?e.apply(void 0,n):e},L=function(e){return e.target.shadowRoot&&"function"==typeof e.composedPath?e.composedPath()[0]:e.target},re=function(e,t){function a(e,t,n){return e&&void 0!==e[t]?e[t]:s[n||t]}function i(e){var t=f("setReturnFocus",e);return t||!1!==t&&e}function r(){if(l.active)J.activateTrap(g),l.delayInitialFocusTimer=s.delayInitialFocus?ee(function(){b(o())}):b(o()),c.addEventListener("focusin",h,!0),c.addEventListener("mousedown",n,{capture:!0,passive:!1}),c.addEventListener("touchstart",n,{capture:!0,passive:!1}),c.addEventListener("click",y,{capture:!0,passive:!1}),c.addEventListener("keydown",m,{capture:!0,passive:!1})}function u(){if(l.active)c.removeEventListener("focusin",h,!0),c.removeEventListener("mousedown",n,!0),c.removeEventListener("touchstart",n,!0),c.removeEventListener("click",y,!0),c.removeEventListener("keydown",m,!0)}var c=t?.document||document,s=X({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},t),l={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},d=function(n){return l.containerGroups.findIndex(function(e){var t=e.container,e=e.tabbableNodes;return t.contains(n)||e.find(function(e){return e===n})})},f=function(e){var t=s[e];if("function"==typeof t){for(var n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];t=t.apply(void 0,o)}if(!(t=!0===t?void 0:t)){if(void 0===t||!1===t)return t;throw new Error("`".concat(e,"` was specified but was not a node, or did not return a node"))}var a=t;if("string"!=typeof t||(a=c.querySelector(t)))return a;throw new Error("`".concat(e,"` as selector refers to no known node"))},o=function(){var e,t=f("initialFocus");if(!1===t)return!1;if(t=void 0===t?0<=d(c.activeElement)?c.activeElement:(e=l.tabbableGroups[0])&&e.firstTabbableNode||f("fallbackFocus"):t)return t;throw new Error("Your focus-trap needs to have at least one focusable element")},p=function(){if(l.containerGroups=l.containers.map(function(e){var t=z(e,s.tabbableOptions),o=x(e,s.tabbableOptions);return{container:e,tabbableNodes:t,focusableNodes:o,firstTabbableNode:0<t.length?t[0]:null,lastTabbableNode:0<t.length?t[t.length-1]:null,nextTabbableNode:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=o.findIndex(function(e){return e===t});if(!(n<0))return e?o.slice(n+1).find(function(e){return A(e,s.tabbableOptions)}):o.slice(0,n).reverse().find(function(e){return A(e,s.tabbableOptions)})}}}),l.tabbableGroups=l.containerGroups.filter(function(e){return 0<e.tabbableNodes.length}),l.tabbableGroups.length<=0&&!f("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},b=function e(t){!1!==t&&t!==c.activeElement&&(t&&t.focus?(t.focus({preventScroll:!!s.preventScroll}),l.mostRecentlyFocusedNode=t,Te(t)&&t.select()):e(o()))},n=function(e){var t=L(e);0<=d(t)||(O(s.clickOutsideDeactivates,e)?g.deactivate({returnFocus:s.returnFocusOnDeactivate&&!R(t,s.tabbableOptions)}):O(s.allowOutsideClick,e)||e.preventDefault())},h=function(e){var t=L(e),n=0<=d(t);n||t instanceof Document?n&&(l.mostRecentlyFocusedNode=t):(e.stopImmediatePropagation(),b(l.mostRecentlyFocusedNode||o()))},v=function(e){var t,n,o,r=L(e),a=(p(),null);0<l.tabbableGroups.length?(o=0<=(t=d(r))?l.containerGroups[t]:void 0,t<0?a=e.shiftKey?l.tabbableGroups[l.tabbableGroups.length-1].lastTabbableNode:l.tabbableGroups[0].firstTabbableNode:e.shiftKey?0<=(n=(n=te(l.tabbableGroups,function(e){e=e.firstTabbableNode;return r===e}))<0&&(o.container===r||R(r,s.tabbableOptions)&&!A(r,s.tabbableOptions)&&!o.nextTabbableNode(r,!1))?t:n)&&(n=0===n?l.tabbableGroups.length-1:n-1,a=l.tabbableGroups[n].lastTabbableNode):0<=(n=(n=te(l.tabbableGroups,function(e){e=e.lastTabbableNode;return r===e}))<0&&(o.container===r||R(r,s.tabbableOptions)&&!A(r,s.tabbableOptions)&&!o.nextTabbableNode(r))?t:n)&&(o=n===l.tabbableGroups.length-1?0:n+1,a=l.tabbableGroups[o].firstTabbableNode)):a=f("fallbackFocus"),a&&(e.preventDefault(),b(a))},m=function(e){Fe(e)&&!1!==O(s.escapeDeactivates,e)?(e.preventDefault(),g.deactivate()):Se(e)&&v(e)},y=function(e){var t=L(e);0<=d(t)||O(s.clickOutsideDeactivates,e)||O(s.allowOutsideClick,e)||(e.preventDefault(),e.stopImmediatePropagation())},g={get active(){return l.active},get paused(){return l.paused},activate:function(e){var t,n,o;return l.active||(t=a(e,"onActivate"),n=a(e,"onPostActivate"),(o=a(e,"checkCanFocusTrap"))||p(),l.active=!0,l.paused=!1,l.nodeFocusedBeforeActivation=c.activeElement,t&&t(),e=function(){o&&p(),r(),n&&n()},o?o(l.containers.concat()).then(e,e):e()),this},deactivate:function(e){var t,n,o,r;return l.active&&(e=X({onDeactivate:s.onDeactivate,onPostDeactivate:s.onPostDeactivate,checkCanReturnFocus:s.checkCanReturnFocus},e),clearTimeout(l.delayInitialFocusTimer),l.delayInitialFocusTimer=void 0,u(),l.active=!1,l.paused=!1,J.deactivateTrap(g),t=a(e,"onDeactivate"),n=a(e,"onPostDeactivate"),o=a(e,"checkCanReturnFocus"),r=a(e,"returnFocus","returnFocusOnDeactivate"),t&&t(),e=function(){ee(function(){r&&b(i(l.nodeFocusedBeforeActivation)),n&&n()})},r&&o?o(i(l.nodeFocusedBeforeActivation)).then(e,e):e()),this},pause:function(){return l.paused||!l.active||(l.paused=!0,u()),this},unpause:function(){return l.paused&&l.active&&(l.paused=!1,p(),r()),this},updateContainerElements:function(e){e=[].concat(e).filter(Boolean);return l.containers=e.map(function(e){return"string"==typeof e?c.querySelector(e):e}),l.active&&p(),this}};return g.updateContainerElements(e),g};function ne(e){let n,o;window.addEventListener("focusin",()=>{n=o,o=document.activeElement}),e.magic("focus",e=>{let t=e;return{__noscroll:!1,__wrapAround:!1,within(e){return t=e,this},withoutScrolling(){return this.__noscroll=!0,this},noscroll(){return this.__noscroll=!0,this},withWrapAround(){return this.__wrapAround=!0,this},wrap(){return this.withWrapAround()},focusable(e){return R(e)},previouslyFocused(){return n},lastFocused(){return n},focused(){return o},focusables(){return Array.isArray(t)?t:x(t,{displayCheck:"none"})},all(){return this.focusables()},isFirst(e){var t=this.all();return t[0]&&t[0].isSameNode(e)},isLast(e){var t=this.all();return t.length&&t.slice(-1)[0].isSameNode(e)},getFirst(){return this.all()[0]},getLast(){return this.all().slice(-1)[0]},getNext(){var e=this.all(),t=document.activeElement;if(-1!==e.indexOf(t))return this.__wrapAround&&e.indexOf(t)===e.length-1?e[0]:e[e.indexOf(t)+1]},getPrevious(){var e=this.all(),t=document.activeElement;if(-1!==e.indexOf(t))return this.__wrapAround&&0===e.indexOf(t)?e.slice(-1)[0]:e[e.indexOf(t)-1]},first(){this.focus(this.getFirst())},last(){this.focus(this.getLast())},next(){this.focus(this.getNext())},previous(){this.focus(this.getPrevious())},prev(){return this.previous()},focus(e){e&&setTimeout(()=>{e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.focus({preventScroll:this.__noscroll})})}}}),e.directive("trap",e.skipDuringClone((t,{expression:e,modifiers:n},{effect:o,evaluateLater:r,cleanup:a})=>{let i=r(e),u=!1,c={escapeDeactivates:!1,allowOutsideClick:!0,fallbackFocus:()=>t};n.includes("noautofocus")?c.initialFocus=!1:(r=t.querySelector("[autofocus]"))&&(c.initialFocus=r);let s=re(t,c),l=()=>{},d=()=>{},f=()=>{l(),l=()=>{},d(),d=()=>{},s.deactivate({returnFocus:!n.includes("noreturn")})};o(()=>i(e=>{u!==e&&(e&&!u&&(n.includes("noscroll")&&(d=Ee()),n.includes("inert")&&(l=ae(t)),setTimeout(()=>{s.activate()},15)),!e&&u&&f(),u=!!e)})),a(f)},(e,{expression:t,modifiers:n},{evaluate:o})=>{n.includes("inert")&&o(t)&&ae(e)}))}function ae(e){let n=[];return ie(e,e=>{let t=e.hasAttribute("aria-hidden");e.setAttribute("aria-hidden","true"),n.push(()=>t||e.removeAttribute("aria-hidden"))}),()=>{for(;n.length;)n.pop()()}}function ie(t,n){!t.isSameNode(document.body)&&t.parentNode&&Array.from(t.parentNode.children).forEach(e=>{e.isSameNode(t)?ie(t.parentNode,n):n(e)})}function Ee(){let e=document.documentElement.style.overflow,t=document.documentElement.style.paddingRight,n=window.innerWidth-document.documentElement.clientWidth;return document.documentElement.style.overflow="hidden",document.documentElement.style.paddingRight=n+"px",()=>{document.documentElement.style.overflow=e,document.documentElement.style.paddingRight=t}}var Ie=ne;export{Ie as default,ne as focus};